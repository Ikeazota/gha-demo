name: If Demowith functions
on: 
  push:
    branches:
      - main
      - develop
      - features/**

jobs:
  QA-checks:
    if: startsWith(github.ref_name, 'feature') && github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - name: perform code qulaity checks
        if: github.ref_name == 'main'
        run: |
          echo "This is the main branch. Running the job."
          exit 1

  dev_deploy:
    if: github.ref_name == 'develop' && github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - name: Dev deploy
        run: echo "deploying to the development environment."

  prod_deploy:
    if: github.ref_name == 'main' && github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - name: Prod deploy
        run: echo "deploying to the production environment."

  success_notify:
    needs: ['prod_deploy', 'dev_deploy', 'QA-checks']
    if: always() && !failure()
    runs-on: ubuntu-latest
    steps:
      - name: Success notification
        run: echo "Deployment to production environment was successful."

  failure_notify:
    needs: ['prod_deploy', 'dev_deploy', 'QA-checks']
    if: failure()
    runs-on: ubuntu-latest
    steps:
      - name: Failure notification
        run: echo "Deployment to production environment failed."